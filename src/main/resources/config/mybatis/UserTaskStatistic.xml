<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hmrz.mybatis.userTaskStatistic">
	
	
	<select id="getUserTaskStatisticCount" parameterType="TaskStatisticSearch" resultType="int">
	
		 SELECT count(1) FROM app_user au 
		 LEFT JOIN xt_city xc ON au.city = xc.district_code AND xc.city_level = 5
		 
		 <if test=' task_type != null and task_type != "" '>
		 	LEFT JOIN app_credit_data acd ON au.user_id = acd.user_id and acd.task_biz = #{task_type}
		 </if>
		 
	  	 <where>
	   		<if test="moble != null and moble != ''">
				au.moble = #{moble} AND
			</if>
	    	<if test="city_code != null and city_code != '' and city_code != '-1' ">
				xc.city_code = #{city_code}  AND
			</if>
			<if test="credit_min != null and credit_min != '' ">
				acd.total &gt;= #{credit_min}  AND
			</if>
			<if test="credit_max != null and credit_max != '' ">
				acd.total &lt;= #{credit_max}  AND
			</if>
			au.is_del = 0
		</where>
		
	</select>
	<!-- 监测执行统计 -->
	<select id="getUserMonitorStatisticList" parameterType="TaskStatisticSearch" resultType="TaskStatisticBean">
		SELECT au.user_id,au.moble,xc.city_name,acd.total,
		
		(SELECT count(1) FROM s_monitor_execute sme WHERE sme.executor = au.user_id ) apply_times,
		
		(SELECT count(1) FROM s_monitor_execute sme WHERE sme.executor = au.user_id and sme.status &lt;&gt; 0 ) apply_success,

		(SELECT count(1) FROM s_monitor_execute sme WHERE sme.executor = au.user_id and sme.status = 6 ) abandoned_times,

		(SELECT count(1) FROM s_monitor_execute sme WHERE sme.executor = au.user_id and sme.status in (3,4,5) ) submit_times,

		(SELECT count(1) FROM s_monitor_execute sme WHERE sme.executor = au.user_id and sme.status = 4 ) passed_times,

		(SELECT count(1) FROM s_monitor_execute sme WHERE sme.executor = au.user_id and sme.status = 5 ) reject_times

		 FROM app_user au 
		 LEFT JOIN xt_city xc ON au.city = xc.district_code AND xc.city_level = 5
		 LEFT JOIN app_credit_data acd ON au.user_id = acd.user_id and acd.task_biz = 1
	  	 <where>
	   		<if test="moble != null and moble != ''">
				au.moble = #{moble} AND
			</if>
	    	<if test="city_code != null and city_code != '' and city_code != '-1' ">
				xc.city_code = #{city_code}  AND
			</if>
			<if test="credit_min != null and credit_min != '' ">
				acd.total &gt;= #{credit_min}  AND
			</if>
			<if test="credit_max != null and credit_max != '' ">
				acd.total &lt;= #{credit_max}  AND
			</if>
			au.is_del = 0
		</where>
		 ORDER BY au.user_id
		 <if test="havePage == 1">
            LIMIT #{start},#{rows}
        </if>
        
	</select>
	
	<!-- 找媒体执行统计 -->
	<select id="getUserMediaStatisticList"  parameterType="TaskStatisticSearch" resultType="TaskStatisticBean">
	
		SELECT au.user_id,au.moble,xc.city_name,
		
		(SELECT COUNT(1) FROM (SELECT sme.task_id,sme.executor FROM s_media_execute sme,s_media sm,s_task_type stt WHERE sme.task_id = sm.task_id and sm.task_type_id = stt.task_type_id and stt.father_id = 3 group by sme.task_id,sme.executor ) A where A.executor = au.user_id ) task_involed,

		(SELECT count(1) FROM s_media_execute sme,s_media sm,s_task_type stt WHERE sme.task_id = sm.task_id and sm.task_type_id = stt.task_type_id and stt.father_id = 3 and sme.executor = au.user_id) submit_times,

		(SELECT count(1) FROM s_media_execute sme,s_media sm,s_task_type stt WHERE sme.task_id = sm.task_id and sm.task_type_id = stt.task_type_id and stt.father_id = 3 and sme.executor = au.user_id and sme.status = 4 ) passed_times,

		(SELECT count(1) FROM s_media_execute sme,s_media sm,s_task_type stt WHERE sme.task_id = sm.task_id and sm.task_type_id = stt.task_type_id and stt.father_id = 3 and sme.executor = au.user_id and sme.status = 5 ) reject_times
		
		 FROM app_user au 
		 LEFT JOIN xt_city xc ON au.city = xc.district_code AND xc.city_level = 5

	  	 <where>
	   		<if test="moble != null and moble != ''">
				au.moble = #{moble} AND
			</if>
	    	<if test="city_code != null and city_code != '' and city_code != '-1'">
				xc.city_code = #{city_code}  AND
			</if>
			au.is_del = 0
		</where>
		 ORDER BY au.user_id
		 <if test="havePage == 1">
            LIMIT #{start},#{rows}
        </if>
        
	</select>
	
	<!-- 商超采集执行统计 -->
	<select id="getUserCollectStatisticList"  parameterType="TaskStatisticSearch" resultType="TaskStatisticBean">
	
		SELECT au.user_id,au.moble,xc.city_name,
		
		(SELECT COUNT(1) FROM (SELECT sme.task_id,sme.executor FROM s_media_execute sme,s_media sm,s_task_type stt WHERE sme.task_id = sm.task_id and sm.task_type_id = stt.task_type_id and stt.father_id = 5 group by sme.task_id,sme.executor ) A where A.executor = au.user_id ) task_involed,

		(SELECT count(1) FROM s_media_execute sme,s_media sm,s_task_type stt WHERE sme.task_id = sm.task_id and sm.task_type_id = stt.task_type_id and stt.father_id = 5 and sme.executor = au.user_id) submit_times,

		(SELECT count(1) FROM s_media_execute sme,s_media sm,s_task_type stt WHERE sme.task_id = sm.task_id and sm.task_type_id = stt.task_type_id and stt.father_id = 5 and sme.executor = au.user_id and sme.status = 4 ) passed_times,

		(SELECT count(1) FROM s_media_execute sme,s_media sm,s_task_type stt WHERE sme.task_id = sm.task_id and sm.task_type_id = stt.task_type_id and stt.father_id = 5 and sme.executor = au.user_id and sme.status = 5 ) reject_times
		
		 FROM app_user au 
		 LEFT JOIN xt_city xc ON au.city = xc.district_code AND xc.city_level = 5

	  	 <where>
	   		<if test="moble != null and moble != ''">
				au.moble = #{moble} AND
			</if>
	    	<if test="city_code != null and city_code != '' and city_code != '-1' ">
				xc.city_code = #{city_code}  AND
			</if>
			au.is_del = 0
		</where>
		 ORDER BY au.user_id
		 <if test="havePage == 1">
            LIMIT #{start},#{rows}
        </if>
        
	</select>
	
	<!-- 商超督察执行统计 -->
	<select id="getUserInspecteStatisticList" parameterType="TaskStatisticSearch" resultType="TaskStatisticBean">
		SELECT au.user_id,au.moble,xc.city_name,acd.total,
		
		(SELECT count(1) FROM s_inspecte_execute sme WHERE sme.executor = au.user_id ) apply_times,
		
		(SELECT count(1) FROM s_inspecte_execute sme WHERE sme.executor = au.user_id and sme.status &lt;&gt; 0 ) apply_success,

		(SELECT count(1) FROM s_inspecte_execute sme WHERE sme.executor = au.user_id and sme.status = 6 ) abandoned_times,

		(SELECT count(1) FROM s_inspecte_execute sme WHERE sme.executor = au.user_id and sme.status in (3,4,5) ) submit_times,

		(SELECT count(1) FROM s_inspecte_execute sme WHERE sme.executor = au.user_id and sme.status = 4 ) passed_times,

		(SELECT count(1) FROM s_inspecte_execute sme WHERE sme.executor = au.user_id and sme.status = 5 ) reject_times

		 FROM app_user au 
		 LEFT JOIN xt_city xc ON au.city = xc.district_code AND xc.city_level = 5
		 LEFT JOIN app_credit_data acd ON au.user_id = acd.user_id and acd.task_biz = 4
	  	 <where>
	   		<if test="moble != null and moble != ''">
				au.moble = #{moble} AND
			</if>
	    	<if test="city_code != null and city_code != '' and city_code != '-1' ">
				xc.city_code = #{city_code}  AND
			</if>
			<if test="credit_min != null and credit_min != '' ">
				acd.total &gt;= #{credit_min}  AND
			</if>
			<if test="credit_max != null and credit_max != '' ">
				acd.total &lt;= #{credit_max}  AND
			</if>
			au.is_del = 0
		</where>
		 ORDER BY au.user_id
		 <if test="havePage == 1">
            LIMIT #{start},#{rows}
        </if>
        
	</select>
	
	
	<!-- 调研执行统计 -->
	<select id="getUserSurveyStatisticList"  parameterType="TaskStatisticSearch" resultType="TaskStatisticBean">
	
		SELECT au.user_id,au.moble,xc.city_name,
		
		(SELECT COUNT(1) FROM (SELECT sme.task_id,sme.executor FROM s_survey_execute sme  group by sme.task_id,sme.executor ) A WHERE A.executor = au.user_id) task_involed,

		(SELECT count(1) FROM s_survey_execute sme WHERE sme.executor = au.user_id ) submit_times,

		(SELECT count(1) FROM s_survey_execute sme WHERE sme.executor = au.user_id and sme.status = 4 ) passed_times,

		(SELECT count(1) FROM s_survey_execute sme WHERE sme.executor = au.user_id and sme.status = 5 ) reject_times

		 FROM app_user au 
		 LEFT JOIN xt_city xc ON au.city = xc.district_code AND xc.city_level = 5
	  	 <where>
	   		<if test="moble != null and moble != ''">
				au.moble = #{moble} AND
			</if>
	    	<if test="city_code != null and city_code != '' and city_code != '-1' ">
				xc.city_code = #{city_code}  AND
			</if>
			au.is_del = 0
		</where>
		 ORDER BY au.user_id
		 <if test="havePage == 1">
            LIMIT #{start},#{rows}
        </if>
        
	</select>
	
	<!-- 微信分享任务执行统计 -->
	<select id="getUserSharewxStatisticList"  parameterType="TaskStatisticSearch" resultType="TaskStatisticBean">
	
		SELECT au.user_id,au.moble,xc.city_name,
		
		(SELECT COUNT(1) FROM (SELECT sswe.task_id,sswe.user_id FROM s_share_wx_execute sswe group by sswe.task_id,sswe.user_id ) A where A.user_id = au.user_id) task_involed,

		(SELECT count(1) FROM s_share_wx_execute sswe WHERE sswe.user_id = au.user_id ) submit_times,

		(SELECT count(1) FROM s_share_wx_data sswd WHERE sswd.user_id = au.user_id  ) click_times,

		(SELECT count(1) FROM s_share_wx_data sswd WHERE sswd.user_id = au.user_id and sswd.click_salary >0  ) valid_click_times

		 FROM app_user au 
		 LEFT JOIN xt_city xc ON au.city = xc.district_code AND xc.city_level = 5
	  	 <where>
	   		<if test="moble != null and moble != ''">
				au.moble = #{moble} AND
			</if>
	    	<if test="city_code != null and city_code != '' and city_code != '-1' ">
				xc.city_code = #{city_code}  AND
			</if>
			au.is_del = 0
		</where>
		 ORDER BY au.user_id
		 <if test="havePage == 1">
            LIMIT #{start},#{rows}
        </if>
        
	</select>
	
	
	<!-- 监测执行详细列表 -->
	<select id="getMonitorExecuteDetailList"  parameterType="TaskExecuteDetailSearch" resultType="TaskExecuteDetailBean">
		SELECT sme.execute_id,sm.task_id,sm.name,stt.name task_type_name,sm.salary,sme.apply_time,xc.city_name,sme.upload_time,sme.status
		FROM s_monitor_execute sme 
		LEFT JOIN s_monitor sm ON sme.task_id = sm.task_id
		LEFT JOIN s_task_type stt ON sm.task_type_id = stt.task_type_id
		LEFT JOIN xt_city xc ON sme.exe_city = xc.city_code and xc.city_level = 4
	 	<where>
	   		<if test="execute_id != null and execute_id != ''">
				sme.execute_id = #{execute_id} AND
			</if>
	    	<if test="task_id != null and task_id !='' ">
				sm.task_id = #{task_id}  AND
			</if>
			<if test="name != null and name !='' ">
				sm.name LIKE CONCAT("%",#{name},"%") AND
			</if>
			<if test="task_type_id != null and task_type_id !='' and task_type_id != '-1' ">
				sm.task_type_id = #{task_type_id} AND
			</if>
			<if test="exe_city !=null and exe_city != '' and exe_city !='-1' ">
				sme.exe_city =  #{exe_city} AND
			</if>
			<if test="status != null and status !='' and status !='-1' ">
				sme.status = #{status} AND
			</if>
			sme.is_history = 0 AND
			sme.executor = #{user_id}
		</where>
		ORDER BY sme.execute_id DESC
		<if test="havePage == 1">
            LIMIT #{start},#{rows}
        </if>
	</select> 
	
	<select id="getMonitorExecuteDetailCount"  parameterType="TaskExecuteDetailSearch" resultType="int">
		SELECT count(1)
		FROM s_monitor_execute sme 
		LEFT JOIN s_monitor sm ON sme.task_id = sm.task_id
	 	<where>
	   		<if test="execute_id != null and execute_id != ''">
				sme.execute_id = #{execute_id} AND
			</if>
	    	<if test="task_id != null and task_id !='' ">
				sm.task_id = #{task_id}  AND
			</if>
			<if test="name != null and name !='' ">
				sm.name LIKE CONCAT("%",#{name},"%") AND
			</if>
			<if test="task_type_id != null and task_type_id !='' and task_type_id != '-1' ">
				sm.task_type_id = #{task_type_id} AND
			</if>
			<if test="exe_city !=null and exe_city != '' and exe_city !='-1' ">
				sme.exe_city =  #{exe_city} AND
			</if>
			<if test="status != null and status !='' and status !='-1' ">
				sme.status = #{status} AND
			</if>
			sme.is_history = 0 AND
			sme.executor = #{user_id}
		</where>
	</select> 
	
	
	<!-- 找媒体执行详细列表 -->
	<select id="getMediaExecuteDetailList"  parameterType="TaskExecuteDetailSearch" resultType="TaskExecuteDetailBean">
		SELECT sme.execute_id,sm.task_id,sm.name,stt.name task_type_name,sm.salary,xc.city_name,sme.upload_time,sme.status
		FROM s_media_execute sme 
		LEFT JOIN s_media sm ON sme.task_id = sm.task_id
		LEFT JOIN s_task_type stt ON sm.task_type_id = stt.task_type_id
		LEFT JOIN xt_city xc ON sme.exe_city = xc.city_code and xc.city_level = 4
		 <where>
	   		<if test="execute_id != null and execute_id != ''">
				sme.execute_id = #{execute_id} AND
			</if>
	    	<if test="task_id != null and task_id !='' ">
				sm.task_id = #{task_id}  AND
			</if>
			<if test="name != null and name !='' ">
				sm.name LIKE CONCAT("%",#{name},"%") AND
			</if>
			<if test="task_type_id != null and task_type_id !='' and task_type_id != '-1' ">
				sm.task_type_id = #{task_type_id} AND
			</if>
			<if test="exe_city !=null and exe_city != '' and exe_city !='-1' ">
				sme.exe_city =  #{exe_city} AND
			</if>
			<if test="status != null and status !='' and status !='-1' ">
				sme.status = #{status} AND
			</if>
			 stt.father_id = 3 AND
			 sme.executor = #{user_id}
		</where>
		ORDER BY sme.execute_id DESC
		<if test="havePage == 1">
            LIMIT #{start},#{rows}
        </if>
	</select>
	
	
	<select id="getMediaExecuteDetailCount"  parameterType="TaskExecuteDetailSearch" resultType="int">
		SELECT COUNT(1)
		FROM s_media_execute sme 
		LEFT JOIN s_media sm ON sme.task_id = sm.task_id
		LEFT JOIN s_task_type stt ON sm.task_type_id = stt.task_type_id
		 <where>
	   		<if test="execute_id != null and execute_id != ''">
				sme.execute_id = #{execute_id} AND
			</if>
	    	<if test="task_id != null and task_id !='' ">
				sm.task_id = #{task_id}  AND
			</if>
			<if test="name != null and name !='' ">
				sm.name LIKE CONCAT("%",#{name},"%") AND
			</if>
			<if test="task_type_id != null and task_type_id !='' and task_type_id != '-1' ">
				sm.task_type_id = #{task_type_id} AND
			</if>
			<if test="exe_city !=null and exe_city != '' and exe_city != '-1' ">
				sme.exe_city =  #{exe_city} AND
			</if>
			<if test="status != null and status !='' and status != '-1' ">
				sme.status = #{status} AND
			</if>
			 stt.father_id = 3 AND
			 sme.executor = #{user_id}
		</where>
	</select>
	
	
	<!-- 商超采集执行详细列表 -->
	<select id="getCollectExecuteDetailList"  parameterType="TaskExecuteDetailSearch" resultType="TaskExecuteDetailBean">
		SELECT sme.execute_id,sm.task_id,sm.name,stt.name task_type_name,sm.salary,xc.city_name,sme.upload_time,sme.status
		FROM s_media_execute sme 
		LEFT JOIN s_media sm ON sme.task_id = sm.task_id
		LEFT JOIN s_task_type stt ON sm.task_type_id = stt.task_type_id 
		LEFT JOIN xt_city xc ON sme.exe_city = xc.city_code and xc.city_level = 4
		 <where>
	   		<if test="execute_id != null and execute_id != ''">
				sme.execute_id = #{execute_id} AND
			</if>
	    	<if test="task_id != null and task_id !='' ">
				sm.task_id = #{task_id}  AND
			</if>
			<if test="name != null and name !='' ">
				sm.name LIKE CONCAT("%",#{name},"%") AND
			</if>
			<if test="task_type_id != null and task_type_id !='' and task_type_id != '-1' ">
				sm.task_type_id = #{task_type_id} AND
			</if>
			<if test="exe_city !=null and exe_city != '' and exe_city != '-1' ">
				sme.exe_city =  #{exe_city} AND
			</if>
			<if test="status != null and status !='' and status != '-1' ">
				sme.status = #{status} AND
			</if>
			 stt.father_id = 5 AND
			 sme.executor = #{user_id}
		</where>
		ORDER BY sme.execute_id DESC
		<if test="havePage == 1">
            LIMIT #{start},#{rows}
        </if>
	</select>
	
	
	<select id="getCollectExecuteDetailCount"  parameterType="TaskExecuteDetailSearch" resultType="int">
		SELECT COUNT(1)
		FROM s_media_execute sme 
		LEFT JOIN s_media sm ON sme.task_id = sm.task_id
		LEFT JOIN s_task_type stt ON sm.task_type_id = stt.task_type_id
		 <where>
	   		<if test="execute_id != null and execute_id != ''">
				sme.execute_id = #{execute_id} AND
			</if>
	    	<if test="task_id != null and task_id !='' ">
				sm.task_id = #{task_id}  AND
			</if>
			<if test="name != null and name !='' ">
				sm.name LIKE CONCAT("%",#{name},"%") AND
			</if>
			<if test="task_type_id != null and task_type_id !='' and task_type_id != '-1' ">
				sm.task_type_id = #{task_type_id} AND
			</if>
			<if test="exe_city !=null and exe_city != '' and exe_city != '-1' ">
				sme.exe_city =  #{exe_city} AND
			</if>
			<if test="status != null and status !='' and status != '-1' ">
				sme.status = #{status} AND
			</if>
			 stt.father_id = 5 AND
			 sme.executor = #{user_id}
		</where>
	</select>
	
	<!-- 商超督察执行详细列表 -->
	<select id="getInspecteExecuteDetailList"  parameterType="TaskExecuteDetailSearch" resultType="TaskExecuteDetailBean">
		SELECT sme.execute_id,sm.task_id,sm.name,stt.name task_type_name,sm.salary,sme.apply_time,xc.city_name,sme.upload_time,sme.status
		FROM s_inspecte_execute sme 
		LEFT JOIN s_inspecte sm ON sme.task_id = sm.task_id
		LEFT JOIN s_task_type stt ON sm.task_type_id = stt.task_type_id
		LEFT JOIN xt_city xc ON sme.exe_city = xc.city_code and xc.city_level = 4
		 <where>
	   		<if test="execute_id != null and execute_id != ''">
				sme.execute_id = #{execute_id} AND
			</if>
	    	<if test="task_id != null and task_id !='' ">
				sm.task_id = #{task_id}  AND
			</if>
			<if test="name != null and name !='' ">
				sm.name LIKE CONCAT("%",#{name},"%") AND
			</if>
			<if test="task_type_id != null and task_type_id !='' and task_type_id != '-1' ">
				sm.task_type_id = #{task_type_id} AND
			</if>
			<if test="exe_city !=null and exe_city != '' and exe_city != '-1' ">
				sme.exe_city =  #{exe_city} AND
			</if>
			<if test="status != null and status !='' and status != '-1' ">
				sme.status = #{status} AND
			</if>
			sme.is_history = 0 AND
			sme.executor = #{user_id}
		</where>
		ORDER BY sme.execute_id DESC
		<if test="havePage == 1">
            LIMIT #{start},#{rows}
        </if>
	</select> 
	
	<select id="getInspecteExecuteDetailCount"  parameterType="TaskExecuteDetailSearch" resultType="int">
		SELECT count(1)
		FROM s_inspecte_execute sme 
		LEFT JOIN s_inspecte sm ON sme.task_id = sm.task_id
	 	<where>
	   		<if test="execute_id != null and execute_id != ''">
				sme.execute_id = #{execute_id} AND
			</if>
	    	<if test="task_id != null and task_id !='' ">
				sm.task_id = #{task_id}  AND
			</if>
			<if test="name != null and name !='' ">
				sm.name LIKE CONCAT("%",#{name},"%") AND
			</if>
			<if test="task_type_id != null and task_type_id !='' and task_type_id != '-1' ">
				sm.task_type_id = #{task_type_id} AND
			</if>
			<if test="exe_city !=null and exe_city != '' and exe_city != '-1' ">
				sme.exe_city =  #{exe_city} AND
			</if>
			<if test="status != null and status !='' and status != '-1' ">
				sme.status = #{status} AND
			</if>
			sme.is_history = 0 AND
			sme.executor = #{user_id}
		</where>
	</select> 
	
	<!-- 调研执行详细列表 -->
	<select id="getSurveyExecuteDetailList"  parameterType="TaskExecuteDetailSearch" resultType="TaskExecuteDetailBean">
		SELECT sme.execute_id,sm.task_id,sm.name,stt.name task_type_name,sm.salary,xc.city_name,sme.upload_time,sme.status
		FROM s_survey_execute sme 
		LEFT JOIN s_survey sm ON sme.task_id = sm.task_id
		LEFT JOIN s_task_type stt ON sm.task_type_id = stt.task_type_id
		LEFT JOIN xt_city xc ON sme.exe_city = xc.city_code and xc.city_level = 4
		 <where>
	   		<if test="execute_id != null and execute_id != ''">
				sme.execute_id = #{execute_id} AND
			</if>
	    	<if test="task_id != null and task_id !='' ">
				sm.task_id = #{task_id}  AND
			</if>
			<if test="name != null and name !='' ">
				sm.name LIKE CONCAT("%",#{name},"%") AND
			</if>
			<if test="task_type_id != null and task_type_id !='' and task_type_id != '-1' ">
				sm.task_type_id = #{task_type_id} AND
			</if>
			<if test="exe_city !=null and exe_city != '' and exe_city != '-1' ">
				sme.exe_city =  #{exe_city} AND
			</if>
			<if test="status != null and status !='' and status != '-1' ">
				sme.status = #{status} AND
			</if>
			sme.executor = #{user_id}
		</where>
		ORDER BY sme.execute_id DESC
		<if test="havePage == 1">
            LIMIT #{start},#{rows}
        </if>
	</select> 
	
	<select id="getSurveyExecuteDetailCount"  parameterType="TaskExecuteDetailSearch" resultType="int">
		SELECT count(1)
		FROM s_survey_execute sme 
		LEFT JOIN s_survey sm ON sme.task_id = sm.task_id
	 	<where>
	   		<if test="execute_id != null and execute_id != ''">
				sme.execute_id = #{execute_id} AND
			</if>
	    	<if test="task_id != null and task_id !='' ">
				sm.task_id = #{task_id}  AND
			</if>
			<if test="name != null and name !='' ">
				sm.name LIKE CONCAT("%",#{name},"%") AND
			</if>
			<if test="task_type_id != null and task_type_id !='' and task_type_id != '-1' ">
				sm.task_type_id = #{task_type_id} AND
			</if>
			<if test="exe_city !=null and exe_city != '' and exe_city != '-1' ">
				sme.exe_city =  #{exe_city} AND
			</if>
			<if test="status != null and status !='' and status != '-1' ">
				sme.status = #{status} AND
			</if>
			sme.executor = #{user_id}
		</where>
	</select> 
	
	<!-- 调研执行详细列表 -->
	<select id="getSharewxExecuteDetailList"  parameterType="TaskExecuteDetailSearch" resultType="TaskExecuteDetailBean">
		SELECT sswe.execute_id,ssw.task_id,ssw.name,ssw.salary,xc.city_name,sswe.share_time,
		(SELECT count(1) FROM s_share_wx_data sswd WHERE sswd.execute_id = sswe.execute_id  ) click_times,
		(SELECT count(1) FROM s_share_wx_data sswd WHERE sswd.execute_id = sswe.execute_id and sswd.click_salary >0  ) valid_click_times 
		FROM s_share_wx_execute sswe 
		LEFT JOIN s_share_wx ssw ON sswe.task_id = ssw.task_id
		LEFT JOIN xt_city xc ON sswe.exe_city = xc.city_code and xc.city_level = 4
		 <where>
	   		<if test="execute_id != null and execute_id != ''">
				sswe.execute_id = #{execute_id} AND
			</if>
	    	<if test="task_id != null and task_id !='' ">
				ssw.task_id = #{task_id}  AND
			</if>
			<if test="name != null and name !='' ">
				ssw.name LIKE CONCAT("%",#{name},"%") AND
			</if>
			<if test="exe_city !=null and exe_city != '' and exe_city != '-1' ">
				sswe.exe_city =  #{exe_city} AND
			</if>
			sswe.user_id = #{user_id}
		</where>
		ORDER BY sswe.execute_id DESC
		<if test="havePage == 1">
            LIMIT #{start},#{rows}
        </if>
	</select> 
	
	<select id="getSharewxExecuteDetailCount"  parameterType="TaskExecuteDetailSearch" resultType="int">
		SELECT COUNT(1) 
		FROM s_share_wx_execute sswe 
		LEFT JOIN s_share_wx ssw ON sswe.task_id = ssw.task_id
		 <where>
	   		<if test="execute_id != null and execute_id != ''">
				sswe.execute_id = #{execute_id} AND
			</if>
	    	<if test="task_id != null and task_id !='' ">
				ssw.task_id = #{task_id}  AND
			</if>
			<if test="name != null and name !='' ">
				ssw.name LIKE CONCAT("%",#{name},"%") AND
			</if>
			<if test="exe_city !=null and exe_city != '' and exe_city != '-1' ">
				sswe.exe_city =  #{exe_city} AND
			</if>
			sswe.user_id = #{user_id}
		</where>
	</select> 
	
</mapper>