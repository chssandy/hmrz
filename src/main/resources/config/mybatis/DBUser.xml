<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hmrz.mybatis.dbuser">
	
	<insert id="addDBUser" parameterType="DBUserBean">
		insert into db_user (moble,password,password_salt,vendor_id,province_code,city_code,remark,create_user) 
		values (#{moble},#{password},#{password_salt},#{vendor_id},#{province_code},#{city_code},#{remark},#{operator})
	</insert>
	
	<insert id="addDBVendor" parameterType="DBVendorBean" useGeneratedKeys="true" keyProperty="vendor_id">
		insert into db_vendor (vendor_name,description) values (#{vendor_name},#{description})
	</insert>
	
	<update id="updateDBUser" parameterType="DBUserBean">
		update db_user set moble = #{moble} , remark = #{remark},province_code = #{province_code},city_code = #{city_code},update_user=#{operator} where user_id = #{user_id}
	</update>
	
	<update id="updateDBUserPassword" parameterType="DBUserBean">
		update db_user set password = #{password} , password_salt = #{password_salt},update_user=#{operator} where user_id = #{user_id}
	</update>
	
	<select id="getDBUserList" parameterType="DBUserSearch" resultType="DBUserBean">
		select du.user_id,du.moble,du.vendor_id,
		du.province_code,du.city_code,
		du.remark,du.create_time,dv.vendor_name from db_user du
		left join db_vendor dv on du.vendor_id = dv.vendor_id
		<where>
			<if test="moble !=null and moble !='' ">
				du.moble = #{moble} AND
			</if>
			<if test="vendor_name !=null and vendor_name !='' ">
				dv.vendor_name LIKE CONCAT("%",#{vendor_name},"%") AND
			</if>
			<if test="create_btime != null and create_btime != ''">
                du.create_time &gt;= CONCAT(#{create_btime}, ' 00:00:00') AND
            </if>
            <if test="create_etime != null and create_etime != ''">
                du.create_time &lt;= CONCAT(#{create_etime}, ' 23:59:59') AND
            </if>
            du.is_del = 0
		</where>
		ORDER BY du.user_id 
		<if test="havePage == 1">
            LIMIT #{start},#{rows}
        </if>
	</select>
	
	<select id="getDBUserCount" parameterType="DBUserSearch" resultType="int">
		select count(1) from db_user du
		left join db_vendor dv on du.vendor_id = dv.vendor_id
		<where>
			<if test="moble !=null and moble !='' ">
				du.moble = #{moble} AND
			</if>
			<if test="vendor_name !=null and vendor_name !='' ">
				dv.vendor_name LIKE CONCAT("%",#{vendor_name},"%") AND
			</if>
			<if test="create_btime != null and create_btime != ''">
                du.create_time &gt;= CONCAT(#{create_btime}, ' 00:00:00') AND
            </if>
            <if test="create_etime != null and create_etime != ''">
                du.create_time &lt;= CONCAT(#{create_etime}, ' 23:59:59') AND
            </if>
            du.is_del = 0
		</where>
	</select>
	
	<select id="getDBUserByID" parameterType="string" resultType="DBUserBean">
		select du.user_id,du.moble,du.vendor_id,du.province_code,du.city_code,du.remark,du.create_time,dv.vendor_name from db_user du
		left join db_vendor dv on du.vendor_id = dv.vendor_id
		where du.user_id = #{user_id}
	</select>
	
	<select id="getDBVendorList" resultType="DBVendorBean">
		select vendor_id,vendor_name from db_vendor where is_del = 0
	</select>
	
</mapper>