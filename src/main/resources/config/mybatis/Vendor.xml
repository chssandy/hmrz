<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hmrz.mybatis.vendor">

	<select id="getAllCustomerByMoble" parameterType="String" resultType="CustomerBean">
		SELECT cc.customer_id,cc.moble,cc.vendor_id,cv.vendor_name FROM c_customer cc
		left join c_vendor cv on cc.vendor_id = cv.vendor_id
		where cc.moble like CONCAT("%",#{moble},"%")
	</select>
	

	<select id="getVendorById" parameterType="String" resultType="VendorBean">
		select 
			cv.vendor_id,
			cv.vendor_name,
			cv.tel,
			cc.customer_name as contact_user,
			cv.moble,
			cv.email,
			cv.vendor_account,
			cv.balance,
			cv.bussiness_license_nums,
			cv.bussiness_license_pic,
			cv.tax_certificate_pic,
			cv.create_user,
			cv.create_time,
			cv.description,
			cv.is_auth
		from c_vendor cv left join c_customer cc on cv.moble = cc.moble
		where cv.vendor_id = #{vendor_id}	
	</select>
	
	<!-- 客户列表 -->
	<select id="getVendorList" parameterType="VendorSearch" resultType="VendorBean">
        SELECT
        	cv.vendor_id,
        	cv.vendor_name,
        	cv.moble,
        	cc.customer_name as contact_user,
        	cv.create_time,
        	cv.is_auth,
    		cv.bussiness_license_nums,
		    cv.bussiness_license_pic,
		    cv.tax_certificate_pic,
		    cv.remark
        FROM 
        	c_vendor cv LEFT JOIN c_customer cc
				ON cv.moble = cc.moble AND cc.is_del = 0
        WHERE cv.is_del = 0
            <if test="create_btime != null and create_btime != ''">
                AND cv.create_time &gt;= CONCAT(#{create_btime}, ' 00:00:00')
            </if>
            <if test="create_etime != null and create_etime != ''">
                AND cv.create_time &lt;= CONCAT(#{create_etime}, ' 23:59:59')
            </if>
            <if test="moble != null and moble != ''">
                AND cv.moble = #{moble}
            </if>
            <if test="vendor_name != null and vendor_name != ''">
                AND cv.vendor_name like concat('%', #{vendor_name},'%')
            </if>
            ORDER BY cv.create_time,cv.vendor_id DESC
	        <if test="havePage == 1">
	        	LIMIT #{start} , #{rows}
	        </if>
	</select>
	
	<select id="getVendorCount" parameterType="VendorSearch" resultType="int">
        SELECT
        	count(1)
        FROM 
        	c_vendor cv
        WHERE
           	cv.is_del = 0
            <if test="create_btime != null and create_btime != ''">
                AND cv.create_time &gt;= CONCAT(#{create_btime}, ' 00:00:00')
            </if>
            <if test="create_etime != null and create_etime != ''">
                AND cv.create_time &lt;= CONCAT(#{create_etime}, ' 23:59:59')
            </if>
            <if test="moble != null and moble != ''">
                AND cv.moble = #{moble}
            </if>
            <if test="vendor_name != null and vendor_name != ''">
                AND cv.vendor_name like concat('%', #{vendor_name},'%')
            </if>
	</select>
	
	
	
	<!-- 结算申请 -->
	<select id="getWithDrawList" parameterType="VendorWithDrawSearch" resultType="VendorWithDrawBean">
        SELECT
        	cvw.balance_id,
        	cvw.balance_user,
        	cc.moble as balance_user_moble,
        	cvw.vendor_id,
        	cvw.alipay_account,
        	cvw.alipay_name,
        	cvw.withdraw_num,
        	cvw.handling_charge,
        	cvw.withdraw_time,
        	cvw.linkman,
        	cvw.linkphone,
        	cvw.remark,
        	(select xm.manager_name from xt_manager xm where xm.manager_id = cvw.auditor ) as auditor,
        	cvw.audit_time,
        	cvw.status
        FROM 
        	c_vendor_withdraw cvw ,c_customer cc
        WHERE
            cvw.balance_user = cc.customer_id
           	 <if test="status != null and status != ''">
           		AND cvw.status = #{status}
           	 </if>
           	 <if test="status == null or status == '' ">
           		AND cvw.status > 0
           	 </if>
            <if test="apply_btime != null and apply_btime != ''">
                AND cvw.withdraw_time &gt;= CONCAT(#{apply_btime}, ' 00:00:00')
            </if>
            <if test="apply_etime != null and apply_etime != ''">
                AND cvw.withdraw_time &lt;= CONCAT(#{apply_etime}, ' 23:59:59')
            </if>
            <if test="audit_btime != null and audit_btime != ''">
                AND cvw.audit_time &gt;= CONCAT(#{audit_btime}, ' 00:00:00')
            </if>
            <if test="audit_etime != null and audit_etime != ''">
                AND cvw.audit_time &lt;= CONCAT(#{audit_etime}, ' 23:59:59')
            </if>
            <if test="moble != null and moble != ''">
                AND cc.moble = #{moble}
            </if>
            ORDER BY 
            <choose>
            	<when test="status == 0">
            		cvw.withdraw_time
            	</when>
            	<otherwise>
            		cvw.withdraw_time DESC
            	</otherwise>
            </choose>
	        <if test="havePage == 1">
	        	LIMIT #{start} , #{rows}
	        </if>
	</select>
	
	<select id="getWithDrawCount" parameterType="VendorWithDrawSearch" resultType="int">
        SELECT
        	count(1)
        FROM 
        	c_vendor_withdraw cvw ,c_customer cc
        WHERE
            cvw.balance_user = cc.customer_id
           	 <if test="status != null and status != ''">
           		AND cvw.status = #{status}
           	 </if>
           	 <if test="status == null or status == '' ">
           		AND cvw.status > 0
           	 </if>
            <if test="apply_btime != null and apply_btime != ''">
                AND cvw.withdraw_time &gt;= CONCAT(#{apply_btime}, ' 00:00:00')
            </if>
            <if test="apply_etime != null and apply_etime != ''">
                AND cvw.withdraw_time &lt;= CONCAT(#{apply_etime}, ' 23:59:59')
            </if>
            <if test="audit_btime != null and audit_btime != ''">
                AND cvw.audit_time &gt;= CONCAT(#{audit_btime}, ' 00:00:00')
            </if>
            <if test="audit_etime != null and audit_etime != ''">
                AND cvw.audit_time &lt;= CONCAT(#{audit_etime}, ' 23:59:59')
            </if>
            <if test="moble != null and moble != ''">
                AND cc.moble = #{moble}
            </if>
	</select>
	
	<!-- 结算申请  操作状态 -->
  	<update id="balanceAlipay" parameterType="java.util.Map">
  	    UPDATE c_vendor_withdraw cvw ,c_customer cc,c_vendor cv
        SET cvw.status = #{status},audit_time = NOW()
        <if test="auditor != null and auditor !='' ">
        ,cvw.auditor = #{auditor}
        </if>
        <if test="status == 3 ">
        ,cv.balance = cv.balance + cvw.withdraw_num + cvw.handling_charge
        </if>
		WHERE cvw.balance_user = cc.customer_id AND cc.vendor_id = cv.vendor_id AND cvw.vendor_id = cc.vendor_id AND cvw.balance_id in
		<foreach collection="id" item="item"  separator="," open="(" close=")">
		(#{item,jdbcType=VARCHAR})
        </foreach>
	</update>
	
  	
  	<!-- 结算申请 -->
	<select id="getChargeList" parameterType="VendorChargeSearch" resultType="VendorChargeBean">
        SELECT
        	cvc.charge_id,
        	cvc.account,
        	cv.vendor_name,    	
        	cvc.charge_time,
        	cvc.source,
        	cvc.order_num,
        	cvc.is_success,
        	cvc.remark,
			cc.moble as charge_user,
			(select xm.manager_name from xt_manager xm where xm.manager_id = cvc.auditor) as auditor,
			cvc.audit_time
        FROM 
        	c_vendor_charge cvc ,c_customer cc,c_vendor cv
        WHERE
            cvc.charge_user = cc.customer_id AND cvc.vendor_id = cv.vendor_id
			<if test="order_num != null and order_num != ''">
				AND cvc.order_num = #{order_num}
			</if>
			<if test="source != null and source != ''">
				AND cvc.source = #{source}
			</if>
			<if test="status != null and status != ''">
				AND cvc.is_success = #{status}
			</if>
			<!-- <if test="status == null or status == '' ">
				AND cvc.is_success &lt; 2
			</if> -->
            <if test="moble != null and moble != ''">
                AND cc.moble = #{moble}
            </if>
            <if test="apply_btime != null and apply_btime != ''">
                AND cvc.charge_time &gt;= CONCAT(#{apply_btime}, ' 00:00:00')
            </if>
            <if test="apply_etime != null and apply_etime != ''">
                AND cvc.charge_time &lt;= CONCAT(#{apply_etime}, ' 23:59:59')
            </if>
            <if test="audit_btime != null and audit_btime != ''">
                AND cvc.audit_time &gt;= CONCAT(#{audit_btime}, ' 00:00:00')
            </if>
            <if test="audit_etime != null and audit_etime != ''">
                AND cvc.audit_time &lt;= CONCAT(#{audit_etime}, ' 23:59:59')
            </if>
            <if test="vendor_name != null and vendor_name != ''">
                AND cv.vendor_name like CONCAT("%",#{vendor_name},"%")
            </if>
            ORDER BY 
           		cvc.charge_time DESC
	        <if test="havePage == 1">
	        	LIMIT #{start} , #{rows}
	        </if>
	</select>
	
	<update id="updateChargeRemark" parameterType="VendorChargeBean">
			update c_vendor_charge set remark = #{remark} where charge_id = #{charge_id}
	</update>
	
	<select id="getChargeCount" parameterType="VendorChargeSearch" resultType="int">
        SELECT
        	count(1)
        FROM 
        	c_vendor_charge cvc ,c_customer cc,c_vendor cv
        WHERE
            cvc.charge_user = cc.customer_id AND cvc.vendor_id = cv.vendor_id
			<if test="order_num != null and order_num != ''">
				AND cvc.order_num = #{order_num}
			</if>
			<if test="source != null and source != ''">
				AND cvc.source = #{source}
			</if>
			<if test="status != null and status != ''">
				AND cvc.is_success = #{status}
			</if>
			<!-- <if test="status == null or status == '' ">
				AND cvc.is_success &lt; 2
			</if> -->
            <if test="moble != null and moble != ''">
                AND cc.moble = #{moble}
            </if>
            <if test="apply_btime != null and apply_btime != ''">
                AND cvc.charge_time &gt;= CONCAT(#{apply_btime}, ' 00:00:00')
            </if>
            <if test="apply_etime != null and apply_etime != ''">
                AND cvc.charge_time &lt;= CONCAT(#{apply_etime}, ' 23:59:59')
            </if>
            <if test="audit_btime != null and audit_btime != ''">
                AND cvc.audit_time &gt;= CONCAT(#{audit_btime}, ' 00:00:00')
            </if>
            <if test="audit_etime != null and audit_etime != ''">
                AND cvc.audit_time &lt;= CONCAT(#{audit_etime}, ' 23:59:59')
            </if>
            <if test="vendor_name != null and vendor_name != ''">
                AND cv.vendor_name like CONCAT("%",#{vendor_name},"%")
            </if>
	</select>
	
	<!-- 充值申请  操作状态 -->
  	<update id="charge" parameterType="java.util.Map">
  	    UPDATE c_vendor_charge cvc ,c_vendor cv
        SET cvc.is_success = #{is_success},audit_time = NOW()
        <if test="auditor != null and auditor !='' ">
        ,cvc.auditor = #{auditor}
        </if>
        <if test="is_success == 1 ">
        ,cv.balance = cv.balance + cvc.account
        </if>
		WHERE cvc.vendor_id = cv.vendor_id AND cvc.is_success = 0 AND cvc.charge_id in
		<foreach collection="id" item="item"  separator="," open="(" close=")">
		(#{item,jdbcType=VARCHAR})
        </foreach>
	</update>
	
  	
  	<!-- 客户账户明细列表 -->
	<select id="getVendorAccountList" parameterType="VendorSearch" resultType="VendorAccountBean">
        select 
			cv.vendor_id,
			cv.vendor_name,
			cv.moble,
			cc.customer_name as contact_user,
			(select IFNULL(sum(cvc.account),0) from c_vendor_charge cvc where cvc.vendor_id = cv.vendor_id AND cvc.source &lt; 2 AND cvc.is_success = 1
				<if test="create_btime != null and create_btime !='' ">
				 	AND cvc.audit_time &gt;= CONCAT(#{create_btime}, ' 00:00:00')
				</if>
				<if test="create_etime != null and create_etime !='' ">
				 	AND cvc.audit_time &lt;= CONCAT(#{create_etime}, ' 23:59:59')
				</if>
			) as charge,
		  	(select IFNULL(sum(cvc.account),0) from c_vendor_charge cvc where cvc.vendor_id = cv.vendor_id AND cvc.source = 2 AND cvc.is_success = 1
		  		<if test="create_btime != null and create_btime !='' ">
				 	AND cvc.audit_time &gt;= CONCAT(#{create_btime}, ' 00:00:00')
				</if>
				<if test="create_etime != null and create_etime !='' ">
				 	AND cvc.audit_time &lt;= CONCAT(#{create_etime}, ' 23:59:59')
				</if>
		  	) as  reward,
			(select IFNULL(sum(cvc.reality_task_consume),0) from c_vendor_cost cvc where cvc.vendor_id = cv.vendor_id 
				<if test="create_btime != null and create_btime !='' ">
				 	AND cvc.create_time &gt;= CONCAT(#{create_btime}, ' 00:00:00')
				</if>
				<if test="create_etime != null and create_etime !='' ">
				 	AND cvc.create_time &lt;= CONCAT(#{create_etime}, ' 23:59:59')
				</if>
			) as consume_task,
			(select IFNULL(sum(cvc.task_consume+cvc.plat_consume),0) from c_vendor_consume cvc where cvc.vendor_id = cv.vendor_id 
				AND cvc.task_type = 7  <!-- 此处专门取上报的金额 -->
				<if test="create_btime != null and create_btime !='' ">
				 	AND cvc.create_time &gt;= CONCAT(#{create_btime}, ' 00:00:00')
				</if>
				<if test="create_etime != null and create_etime !='' ">
				 	AND cvc.create_time &lt;= CONCAT(#{create_etime}, ' 23:59:59')
				</if>
			) as consume_report,
			( select (consume_task+consume_report) ) consume,
			(select IFNULL(sum(cvc.reality_plat_consume),0) from c_vendor_cost cvc where cvc.vendor_id = cv.vendor_id 
				<if test="create_btime != null and create_btime !='' ">
				 	AND cvc.create_time &gt;= CONCAT(#{create_btime}, ' 00:00:00')
				</if>
				<if test="create_etime != null and create_etime !='' ">
				 	AND cvc.create_time &lt;= CONCAT(#{create_etime}, ' 23:59:59')
				</if>
			) as plat_fee,
			(select IFNULL(sum(cvw.withdraw_num),0) from c_vendor_withdraw cvw where cvw.vendor_id = cv.vendor_id AND cvw.status = 1
				<if test="create_btime != null and create_btime !='' ">
				 	AND cvw.audit_time &gt;= CONCAT(#{create_btime}, ' 00:00:00')
				</if>
				<if test="create_etime != null and create_etime !='' ">
				 	AND cvw.audit_time &lt;= CONCAT(#{create_etime}, ' 23:59:59')
				</if>
			) as withdraw,
			(select IFNULL(sum(cvw.handling_charge),0) from c_vendor_withdraw cvw where cvw.vendor_id = cv.vendor_id AND cvw.status = 1
				<if test="create_btime != null and create_btime !='' ">
				 	AND cvw.audit_time &gt;= CONCAT(#{create_btime}, ' 00:00:00')
				</if>
				<if test="create_etime != null and create_etime !='' ">
				 	AND cvw.audit_time &lt;= CONCAT(#{create_etime}, ' 23:59:59')
				</if>
			) as handling,
			(select IFNULL(sum(withdraw_num+handling_charge),0) from c_vendor_withdraw cvw where cvw.vendor_id = cv.vendor_id AND cvw.status = 0 or cvw.status=2
				<if test="create_btime != null and create_btime !='' ">
				 	AND cvw.audit_time &gt;= CONCAT(#{create_btime}, ' 00:00:00')
				</if>
				<if test="create_etime != null and create_etime !='' ">
				 	AND cvw.audit_time &lt;= CONCAT(#{create_etime}, ' 23:59:59')
				</if>
			) as withdraw_frozen,
			(select IFNULL((sum(cvc.task_imprest)+SUM(cvc.plat_imprest)),0) from c_vendor_cost cvc where cvc.vendor_id = cv.vendor_id AND cvc.account_time is NULL
				<if test="create_btime != null and create_btime !='' ">
				 	AND cvc.create_time &gt;= CONCAT(#{create_btime}, ' 00:00:00')
				</if>
				<if test="create_etime != null and create_etime !='' ">
				 	AND cvc.create_time &lt;= CONCAT(#{create_etime}, ' 23:59:59')
				</if>
			) as frozen,
			cv.balance,
			(select (charge+reward) = (consume+plat_fee+withdraw+handling+withdraw_frozen+frozen+balance) ) as is_balance
			
        FROM 
        	c_vendor cv,c_customer cc
        WHERE
        	cv.moble = cc.moble
           	AND cv.is_del = 0
            <if test="moble != null and moble != ''">
                AND cv.moble = #{moble}
            </if>
            <if test="vendor_name != null and vendor_name != ''">
                AND cv.vendor_name like concat('%', #{vendor_name},'%')
            </if>
            ORDER BY cv.create_time,cv.vendor_id DESC
	        <if test="havePage == 1">
	        	LIMIT #{start} , #{rows}
	        </if>
	</select>
	
	<select id="getVendorAccountSum" resultType="VendorAccountBean">
		 SELECT (select IFNULL(SUM(account),0) from c_vendor_charge where is_success = 1 and source &lt; 2) charge,

		(select IFNULL(SUM(account),0) from c_vendor_charge where is_success = 1 and source = 2) reward,
		
		( (select IFNULL(sum(reality_task_consume),0) from c_vendor_cost) +
		(select IFNULL(sum(task_consume+plat_consume),0) from c_vendor_consume where task_type = 7) )  consume,
		
		(select IFNULL(sum(reality_plat_consume),0) from c_vendor_cost) plat_fee,  
		
		(select IFNULL(sum(task_imprest+plat_imprest),0) from c_vendor_cost where account_time is null) frozen, 
		
		(select IFNULL(sum(withdraw_num),0) from c_vendor_withdraw where `status`  = 1) withdraw,
		
		(select IFNULL(sum(handling_charge),0) from c_vendor_withdraw where `status` = 1) handling,
		
		(select IFNULL(sum(withdraw_num+handling_charge),0) from c_vendor_withdraw where `status` = 0 or `status` = 2 ) withdraw_frozen,
		
		(select IFNULL(sum(balance),0) from c_vendor) balance,
		
		(select (charge+reward) = (consume+plat_fee+frozen+withdraw+handling+withdraw_frozen+balance)) is_balance
	</select>
	
	<update id="remarkVendor" parameterType="HashMap">
    	UPDATE c_vendor
    	<set>
    		<if test="remark != null and remark != ''">
    			remark = #{remark}
    		</if>
    	</set>
    	WHERE vendor_id = #{vendor_id}
    </update>
	
	<select id="getVendorAccountCount" parameterType="VendorSearch" resultType="int">
        SELECT
        	count(1)
        FROM 
        	c_vendor cv
        WHERE
           	cv.is_del = 0
            <if test="moble != null and moble != ''">
                AND cv.moble = #{moble}
            </if>
            <if test="vendor_name != null and vendor_name != ''">
                AND cv.vendor_name like concat('%', #{vendor_name},'%')
            </if>
	</select>
	
	 <update id="modifyVendor" parameterType="VendorBean">
    	UPDATE c_vendor
    	<set>
    		<if test="vendor_name != null and vendor_name != ''">
    			vendor_name = #{vendor_name},
    		</if>
    		<if test="bussiness_license_nums != null and bussiness_license_nums != ''">
    			bussiness_license_nums = #{bussiness_license_nums},
    		</if>
    		<if test="bussiness_license_pic != null and bussiness_license_pic != ''">
    			bussiness_license_pic = #{bussiness_license_pic},
    		</if>
    		<if test="tax_certificate_pic != null and tax_certificate_pic != ''">
    			tax_certificate_pic = #{tax_certificate_pic},
    		</if>
    		<if test="is_auth != null and is_auth != ''">
    			is_auth = #{is_auth}
    		</if>
    	</set>
    	WHERE vendor_id = #{vendor_id}
    </update>
    
    <insert id="addReward" parameterType="VendorChargeBean">
    	insert into c_vendor_charge(vendor_id,account,auditor,audit_time,source,is_success,remark)
    	values (#{vendor_id},#{account},#{auditor},NOW(),#{source},#{is_success},#{remark})
    </insert>
    
    <select id="getVendorRewardList" parameterType="VendorChargeSearch" resultType="VendorChargeBean">
    	SELECT cvc.charge_id,cvc.account,xm.manager_name,cvc.audit_time,cvc.remark 
    	FROM c_vendor_charge cvc 
    	LEFT JOIN xt_manager xm ON cvc.auditor = xm.manager_id 
    	WHERE cvc.vendor_id = #{vendor_id} AND cvc.source = 2
    	<if test="auditor !=null and auditor != '' ">
    		AND xm.manager_name LIKE CONCAT("%",#{auditor},"%") 
    	</if>
   	 	<if test="audit_btime != null and audit_btime != ''">
             AND cvc.audit_time &gt;= CONCAT(#{audit_btime}, ' 00:00:00')
       	</if>
        <if test="audit_etime != null and audit_etime != ''">
            AND cvc.audit_time &lt;= CONCAT(#{audit_etime}, ' 23:59:59')
        </if>
       	ORDER BY cvc.audit_time DESC
       	<if test="havePage == 1">
      		LIMIT #{start} , #{rows}
       	</if>
    </select>
    
    <select id="getVendorRewardCount" parameterType="VendorChargeSearch" resultType="int">
    	SELECT count(1)
    	FROM c_vendor_charge cvc 
    	LEFT JOIN xt_manager xm ON cvc.auditor = xm.manager_id 
    	WHERE cvc.vendor_id = #{vendor_id} AND cvc.source = 2
    	<if test="auditor !=null and auditor != '' ">
    		AND xm.manager_name LIKE CONCAT("%",#{auditor},"%") 
    	</if>
   	 	<if test="audit_btime != null and audit_btime != ''">
            AND cvc.audit_time &gt;= CONCAT(#{audit_btime}, ' 00:00:00')
       	</if>
        <if test="audit_etime != null and audit_etime != ''">
            AND cvc.audit_time &lt;= CONCAT(#{audit_etime}, ' 23:59:59')
        </if>
    </select>
    
	<select id="customerCount" parameterType="VendorSearch" resultType="int">
	    SELECT
		  COUNT(*)
		FROM c_customer cc
		WHERE cc.vendor_id = #{vendor_id}
    </select>
    
    <select id="customerList"  parameterType="VendorSearch" resultType="CustomerBean">
    	SELECT
		  cc.customer_id,
		  cc.customer_name,
		  cc.moble,
		  cc.create_time,
		  (select ccc.moble from c_customer ccc where ccc.customer_id = cc.create_user) as create_user,
		  cc.remark,
		  cc.is_del
		FROM c_customer cc
		WHERE cc.vendor_id = #{vendor_id}
		<if test="havePage == 1">
        	LIMIT #{start} , #{rows}
        </if>
    </select>
    
    <update id="customerOp" parameterType="CustomerBean" >
		update C_CUSTOMER set is_del = #{is_del} where customer_id = #{customer_id}
	</update>
	
	<select id="getReportConsumeList" parameterType="VendorSearch" resultType="VendorConsumeBean" >
		select cvc.execute_id,cvc.task_name,IFNULL(cvc.task_consume+cvc.plat_consume,0) task_consume,cvc.create_time ,au.moble
		from c_vendor_consume cvc
		left join report_plan_execute rpe on cvc.execute_id = rpe.execute_id
		left join app_user au on rpe.executor =  au.user_id
		<where>
			cvc.vendor_id = #{vendor_id} and cvc.task_type = 7 AND cvc.task_consume > 0
			<if test=" execute_id !=null and execute_id !='' ">
				AND cvc.execute_id = #{execute_id} 
			</if>
			<if test=" task_name !=null and task_name !='' ">
				AND cvc.task_name like concat("%",#{task_name},"%") 
			</if>
			<if test="create_btime != null and create_btime != ''">
            	AND cvc.create_time &gt;= CONCAT(#{create_btime}, ' 00:00:00')
	       	</if>
	        <if test="create_etime != null and create_etime != ''">
	            AND cvc.create_time &lt;= CONCAT(#{create_etime}, ' 23:59:59')
	        </if>
		</where>
		ORDER BY cvc.create_time DESC
		<if test="havePage == 1">
     		LIMIT #{start} , #{rows}
       	</if>
	</select>
	
	
	<select id="getReportConsumeCount" parameterType="VendorSearch" resultType="int">
		select count(1)
		from c_vendor_consume cvc
		<where>
			cvc.vendor_id = #{vendor_id} and cvc.task_type = 7 AND cvc.task_consume > 0
			<if test=" execute_id !=null and execute_id !='' ">
				AND cvc.execute_id = #{execute_id} 
			</if>
			<if test=" task_name !=null and task_name !='' ">
				AND cvc.task_name like concat("%",#{task_name},"%") 
			</if>
			<if test="create_btime != null and create_btime != ''">
            	AND cvc.create_time &gt;= CONCAT(#{create_btime}, ' 00:00:00')
	       	</if>
	        <if test="create_etime != null and create_etime != ''">
	            AND cvc.create_time &lt;= CONCAT(#{create_etime}, ' 23:59:59')
	        </if>
		</where>
	</select>
	
	
	
	<insert id="addVendor" parameterType="VendorBean" useGeneratedKeys="true" keyProperty="vendor_id">
	   INSERT INTO c_vendor(vendor_name,moble,description)
	   VALUE(#{vendor_name}, #{moble},#{description})
	</insert>
	
	<insert id="addCustomer" parameterType="VendorBean">
       INSERT INTO c_customer(customer_name, moble, password, password_salt, vendor_id)
       VALUE(#{customer_name}, #{moble}, #{password}, #{password_salt}, #{vendor_id})
    </insert>
</mapper>